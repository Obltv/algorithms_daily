import java.util.*;
/*
è§£é¢˜æ€è·¯
æ ¸å¿ƒè§‚å¯Ÿ
ç›¸ç­‰å¯¹æ•°çš„è®¡ç®—ï¼šå¦‚æœä¸€ä¸ªæ•°å­— x åœ¨å­æ•°ç»„ä¸­å‡ºç° c æ¬¡ï¼Œé‚£ä¹ˆå®ƒèƒ½è´¡çŒ®çš„ç›¸ç­‰å¯¹æ•°ä¸ºç»„åˆæ•° C(c, 2) = c * (c - 1) / 2ã€‚

æ»‘åŠ¨çª—å£çš„é€‚ç”¨æ€§ï¼š

å­æ•°ç»„çš„è¿ç»­æ€§è¦æ±‚é€‚åˆç”¨æ»‘åŠ¨çª—å£å¤„ç†ã€‚

å½“çª—å£æ‰©å¤§ï¼ˆå³æŒ‡é’ˆå³ç§»ï¼‰æ—¶ï¼Œçª—å£å†…çš„ç›¸ç­‰å¯¹æ•°ä¸ä¼šå‡å°‘ï¼›å½“çª—å£ç¼©å°ï¼ˆå·¦æŒ‡é’ˆå·¦ç§»ï¼‰æ—¶ï¼Œç›¸ç­‰å¯¹æ•°ä¸ä¼šå¢åŠ ã€‚è¿™ç§å•è°ƒæ€§ä½¿å¾—æ»‘åŠ¨çª—å£å¯ä»¥é«˜æ•ˆåœ°ç»´æŠ¤æ»¡è¶³æ¡ä»¶çš„åŒºé—´ã€‚

æ»‘åŠ¨çª—å£æ³•
ç»´æŠ¤çª—å£ï¼šä½¿ç”¨åŒæŒ‡é’ˆ left å’Œ right è¡¨ç¤ºå½“å‰çª—å£çš„å·¦å³è¾¹ç•Œã€‚

ç»Ÿè®¡é¢‘æ¬¡ï¼šä½¿ç”¨å“ˆå¸Œè¡¨ cnt è®°å½•çª—å£ä¸­æ¯ä¸ªæ•°å­—çš„å‡ºç°æ¬¡æ•°ã€‚

åŠ¨æ€è®¡ç®—å¯¹æ•°ï¼š

å½“æ•°å­— x åŠ å…¥çª—å£æ—¶ï¼Œæ–°å¢çš„ç›¸ç­‰å¯¹æ•°ç­‰äº x åœ¨çª—å£ä¸­å·²å­˜åœ¨çš„æ¬¡æ•° cnt[x]ã€‚

å½“æ•°å­— x ç§»å‡ºçª—å£æ—¶ï¼Œå‡å°‘çš„ç›¸ç­‰å¯¹æ•°ç­‰äº x åœ¨çª—å£ä¸­å‰©ä½™çš„æ¬¡æ•° cnt[x] - 1ã€‚

ç»“æœç»Ÿè®¡ï¼š

å½“çª—å£çš„å¯¹æ•° pairs é¦–æ¬¡æ»¡è¶³ pairs >= k æ—¶ï¼Œæ‰€æœ‰ä»¥ right ç»“å°¾çš„å­æ•°ç»„ä¸­ï¼Œå·¦è¾¹ç•Œåœ¨ [0, left] çš„éƒ½æ»¡è¶³æ¡ä»¶ï¼ˆå› ä¸ºæ›´å°çš„å·¦è¾¹ç•Œä¼šåŒ…å«æ›´å¤šå…ƒç´ ï¼Œå¯¹æ•°åªä¼šæ›´å¤šï¼‰ã€‚

å› æ­¤ï¼Œå¯ä»¥ç›´æ¥ç´¯åŠ  left çš„å€¼åˆ°ç»“æœä¸­ï¼Œé¿å…é‡å¤æ£€æŸ¥ã€‚

class Solution {
    public long countGood(int[] nums, int k) {
        // æœ€ç»ˆç»“æœ
        long res = 0;
        // å½“å‰çª—å£ä¸­çš„ç›¸ç­‰å¯¹æ•°
        int pairs = 0;
        // æ»‘åŠ¨çª—å£çš„å·¦è¾¹ç•Œ
        int left = 0;
        // å“ˆå¸Œè¡¨è®°å½•çª—å£ä¸­å„æ•°å­—çš„å‡ºç°æ¬¡æ•°
        Map<Integer, Integer> map = new HashMap<>();

        // éå†æ•°ç»„ï¼Œå³è¾¹ç•Œrightä»0åˆ°n-1
        for (int num : nums) {
            // è·å–å½“å‰æ•°å­—åœ¨çª—å£ä¸­çš„å‡ºç°æ¬¡æ•°
            int count = map.getOrDefault(num, 0);
            // æ¯æ–°å¢ä¸€ä¸ªç›¸åŒæ•°å­—ï¼Œä¼šå¢åŠ countä¸ªæ–°å¯¹æ•°
            pairs += count;
            // æ›´æ–°å½“å‰æ•°å­—çš„å‡ºç°æ¬¡æ•°
            map.put(num, count + 1);

            // å½“å¯¹æ•°æ»¡è¶³æ¡ä»¶æ—¶ï¼Œæ”¶ç¼©å·¦è¾¹ç•Œ
            while (pairs >= k) {
                // è·å–å·¦è¾¹ç•Œæ•°å­—çš„å‡ºç°æ¬¡æ•°
                int leftNum = nums[left];
                int leftCount = map.get(leftNum);
                // ç§»é™¤å·¦è¾¹ç•Œæ•°å­—ä¼šå‡å°‘leftCount-1ä¸ªå¯¹æ•°
                pairs -= leftCount - 1;
                // æ›´æ–°å·¦è¾¹ç•Œæ•°å­—çš„å‡ºç°æ¬¡æ•°
                map.put(leftNum, leftCount - 1);
                // å·¦è¾¹ç•Œå³ç§»
                left++;
            }

            // å…³é”®ç‚¹è§£é‡Šï¼š
            // å¯¹äºå½“å‰å³è¾¹ç•Œï¼Œæ‰€æœ‰leftå·¦è¾¹çš„ä½ç½®ä½œä¸ºèµ·å§‹ç‚¹çš„å­æ•°ç»„éƒ½æ»¡è¶³æ¡ä»¶
            // å› ä¸ºå¦‚æœleft>0ï¼Œè¯´æ˜[left-1,right]å·²ç»æ»¡è¶³æ¡ä»¶ï¼Œé‚£ä¹ˆ[0,right],[1,right],...,[left-1,right]éƒ½æ»¡è¶³
            // æ‰€ä»¥å¯ä»¥ç›´æ¥ç´¯åŠ leftçš„å€¼
            res += left;
        }

        return res;
    }
}
 */
public class lc2537 {
    public long countGood(int[] nums, int k) {
        //resæ˜¯ç»“æœ
        int res = 0;
        //è®°å½•å¯¹æ•°
        int pairs = 0;
        //æ»‘åŠ¨çª—å£ğŸªŸå·¦ç«¯
        int left = 0;
        //Hash Mapå­˜æ•°ç›®
        Map<Integer, Integer> map = new HashMap<>();
        //éå†
        for (int num : nums) {
            int a = map.getOrDefault(num, 0);
            pairs += a;
            map.put(num, a + 1);
            while (pairs >= k) {
                int b = map.getOrDefault(nums[left], 0);
                //æ˜¯b-1ï¼Œå…¶å®å°±ç›¸å½“äºåç€æ¥
                pairs -= b - 1;
                map.put(nums[left], b - 1);
                left++;
            }
            //è¿™é‡Œæœ‰ç‚¹ä¸ç†è§£è¦æ˜¯æ²¡æ»¡è¶³æ¡ä»¶ä¸ºä»€ä¹ˆè¿˜è¦åŠ 
            //ç†è§£äº†ï¼Œå› ä¸ºä½ æŠŠright++åå³ä½¿æ²¡æœ‰æ»¡è¶³æ¡ä»¶ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥æƒ³è±¡å°†left--åå®ƒè‚¯å®šæ»¡è¶³ï¼Œå…¶å®å°±ç›¸å½“äºå°†çª—å£å»¶é•¿äº†ï¼Œä½†æ˜¯æ²¡æœ‰æ”¹å˜å®ƒæ¯æ¬¡å»¶é•¿åŠ çš„ä¸ªæ•°
            res += left;
        }
        return res;
    }
}
